<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <title>Show do Crentão — Quiz</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://unpkg.com/@supabase/supabase-js"></script>
  <style>
    body{background:#000;color:#fff;font-family:Arial,Helvetica,sans-serif;}
    .card{background:#111;padding:20px;border-radius:12px;max-width:800px;margin:40px auto;}
    button{padding:12px 20px;border:none;border-radius:8px;margin:6px;cursor:pointer;font-weight:600}
    .btn-primary{background:#1fddac;color:#000}
    .btn-secondary{background:#fff;color:#000}
  </style>
</head>
<body>
  <div class="card" id="quiz-box">
    <h2 id="quizPergunta"></h2>
    <div id="quizOpcoes"></div>
    <button id="btnResponder" class="btn-primary">Responder</button>
  </div>

  <script>
    // Conexão com Supabase
    const supabaseUrl = "https://ihajmegcdgwchxslnaep.supabase.co";
    const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImloYWptZWdjZGd3Y2h4c2xuYWVwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY0OTQzMTgsImV4cCI6MjA3MjA3MDMxOH0.WM36lA9n0PU9qd-DKdrWVB_UzGVXpsfJ984oHiXDU8Y";
    const supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);

    let perguntas = [];
    let idx = 0;

    async function carregarPerguntas(){
      const { data, error } = await supabaseClient
        .from("perguntas")
        .select("*")
        .eq("ativo", true);
      if(error){console.error(error);return;}

      // Separar por dificuldade
      const faceis = data.filter(p=>p.dificuldade==='facil');
      const medias = data.filter(p=>p.dificuldade==='medio');
      const dificeis = data.filter(p=>p.dificuldade==='dificil');

      // Embaralhar cada bloco
      function shuffle(arr){ return arr.sort(()=>Math.random()-0.5) }
      const selecionadas = [
        ...shuffle(faceis).slice(0,3),
        ...shuffle(medias).slice(0,3),
        ...shuffle(dificeis).slice(0,10)
      ];

      perguntas = selecionadas;
      renderPergunta();
    }

    function renderPergunta(){
      if(idx>=perguntas.length){
        document.getElementById("quiz-box").innerHTML = "<h2>Fim do Quiz!</h2>";
        return;
      }
      const p=perguntas[idx];
      document.getElementById("quizPergunta").textContent=p.enunciado;
      const box=document.getElementById("quizOpcoes");
      box.innerHTML="";
      p.opcoes.forEach((op,i)=>{
        const lbl=document.createElement("label");
        lbl.style.display="block";
        lbl.innerHTML=`<input type='radio' name='op' value='${i}'> ${op}`;
        box.appendChild(lbl);
      });
    }

    document.getElementById("btnResponder").addEventListener("click",()=>{
      const sel=document.querySelector("input[name=op]:checked");
      if(!sel){alert("Escolha uma opção!");return;}
      const escolha=+sel.value;
      const correta=perguntas[idx].correta;
      if(escolha===correta){
        alert("Certa resposta!");
      } else {
        alert("Errou!");
      }
      idx++;
      renderPergunta();
    });

    carregarPerguntas();
  </script>
</body>
</html>
