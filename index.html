<!docty    #hero{
      position:relative; min-height:100svh;
      display:flex; align-items:flex-end; justify-content:center;
      padding: calc(56px + 10svh) var(--pad) calc(20svh);
      background:#000; overflow:hidden;
      opacity:1; transform:none;
    }
    #hero .bg{ position:absolute; inset:0; z-index:0; display:grid; place-items:center;}
    #heroImg{ width:100%; height:100%; object-fit:cover; user-select:none; -webkit-user-drag:none; filter:none; }
    @media (max-width: 768px){
      #hero{padding: calc(56px + 6svh) var(--pad) calc(18svh);}
      #heroImg{ object-fit:contain; aspect-ratio:auto; object-position: center 70px; }
    }

    /* CTA */
    #hero .cta{
      position:absolute; left:50%; transform:translateX(-50%);
      bottom: calc(12svh + env(safe-area-inset-bottom));
      width:100%; max-width: min(780px, 92vw);
      display:flex; gap:14px; flex-wrap:wrap; justify-content:center; z-index:2;
    }

    .btn{
      appearance:none; border:0; border-radius:18px; padding:18px 28px;
      font-weight:800; letter-spacing:.02em; text-transform:uppercase; cursor:pointer;
      box-shadow: var(--shadow);
      transition: transform .08s ease, box-shadow .2s ease, opacity .2s ease, filter .2s ease;
    }
    .btn:active{transform: translateY(1px); box-shadow: var(--shadow-soft);}
    .btn.primary{ background:linear-gradient(180deg, var(--green) 0%, var(--green-700) 100%); color:#06261f; }
    .btn.secondary{ background:var(--white); color:#0a0d0c }
    .btn.full{ flex:1 1 320px; }

    /* CONTE√öDO */
    main{display:grid; gap:28px; padding:24px var(--pad) 48px; max-width:var(--maxw); margin:0 auto}
    .card{
      background:rgba(12,15,15,.72); backdrop-filter: blur(6px);
      border:1px solid rgba(255,255,255,.06); border-radius:var(--radius);
      box-shadow:var(--shadow); padding: min(28px, 3.2vw);
    }
    h2{margin:0 0 6px; font-size:22px}
    .sub{margin:0 0 14px; font-size:14px; color:#a7b1af}
    label{display:block; font-size:14px; margin:14px 0 6px; color:#cdd5d3}
    input[type="text"], input[type="tel"]{
      width:100%; padding:14px 16px; border-radius:12px; border:1px solid rgba(255,255,255,.08);
      background:#0b0f0e; color:#fff; outline:none;
    }
    .help{font-size:13px; color:#93a29f; margin-top:10px}
    .row{display:flex; gap:12px; flex-wrap:wrap}
    .row .btn{min-width:180px}

    .confirm-box{ margin-top:14px; padding:12px; border-radius:12px; border:1px solid rgba(255,255,255,.08); background:#0a0f0f; }
    .confirm-title{font-weight:800; margin-bottom:10px;}
    .helpbox{margin-top:12px; font-size:13px; color:#a7b1af}

    /* FX */
    #fxOverlay{ position:fixed; inset:0; pointer-events:none; z-index:60; }
    .fx-ok::after{
      content:""; position:absolute; inset:0; margin:auto; width:min(55vmin,520px); height:min(55vmin,520px);
      border-radius:50%; background:radial-gradient(ellipse at center, rgba(31,221,172,.28), rgba(31,221,172,0) 60%);
      animation:okPulse .95s ease-out forwards;
    }
    @keyframes okPulse{ 0%{transform:scale(.7); opacity:.0} 25%{opacity:.9} 100%{transform:scale(1.15); opacity:0} }
    .fx-wrong{ animation:shake .6s ease-in-out 0s 1; }
    .fx-wrong::after{
      content:""; position:absolute; inset:0;
      background:radial-gradient(ellipse at center, rgba(242,78,58,.18), rgba(242,78,58,0) 65%); animation:fadeOut .8s ease forwards;
    }
    @keyframes shake{0%,100%{transform:translateX(0)}20%{transform:translateX(-10px)}40%{transform:translateX(10px)}60%{transform:translateX(-6px)}80%{transform:translateX(6px)}}
    @keyframes fadeOut{ from{opacity:.9} to{opacity:0} }
  </style>
</head>
<body>

  <header>
    <div class="brand">
      <img src="img/logo.png" alt="Sobrenatural Church" onerror="this.style.display='none'">
    </div>
    <div class="right">
      <img id="crentaoLogo" class="title-logo" alt="Show do Crent√£o" />
    </div>
  </header>

  <!-- HOME -->
  <section id="hero">
    <div class="bg">
      <img id="heroImg" alt="Capa ‚Äì Show do Crent√£o" class="hidden">
    </div>
    <div class="cta">
      <button id="btnStart" class="btn primary full">Iniciar</button>
      <button id="btnRanking" class="btn secondary full" onclick="location.href='ranking.html'">Ranking</button>
    </div>
  </section>

  <main>
    <!-- FORM -->
    <section id="section-form" class="card hidden">
      <h2>Dados do participante</h2>
      <label>Nome completo</label>
      <input id="nome" type="text" placeholder="Ex.: Maria Silva">
      <label>Telefone (com DDD)</label>
      <input id="fone" type="tel" placeholder="Ex.: (14) 99999-0000">
      <div class="help">Cada pessoa pode responder <strong>uma √∫nica vez</strong>.</div>
      <div class="row" style="margin-top:16px">
        <button id="btnEnviarDados" class="btn primary">Enviar</button>
      </div>
    </section>

    <!-- QUIZ -->
    <section id="section-quiz" class="card hidden">
      <h2 id="quizPergunta">Pergunta</h2>
      <p id="valorPergunta" class="sub"></p>

      <!-- Ajudas -->
      <div class="row" id="lifelines" style="margin:6px 0 10px">
        <button id="btnUni"  class="btn secondary">Universit√°rios</button>
        <button id="btn5050" class="btn secondary">50/50</button>
        <button id="btnPular" class="btn secondary">Pular</button>
      </div>
      <div id="ajudaBox" class="helpbox hidden"></div>

      <div id="quizOpcoes"></div>

      <!-- Confirmar resposta -->
      <div id="confirmBox" class="confirm-box hidden">
        <div class="confirm-title">Voc√™ tem certeza da resposta?</div>
        <div class="row"><button id="btnConfirmar" class="btn primary">Confirmar</button></div>
      </div>

      <!-- Ap√≥s ACERTO: Parar ou Continuar -->
      <div id="posAcertoBox" class="confirm-box hidden">
        <div class="confirm-title" id="posAcertoTitulo"></div>
        <div class="row">
          <button id="btnParar" class="btn secondary">Parar</button>
          <button id="btnContinuar" class="btn primary">Continuar</button>
        </div>
      </div>

      <div class="row" id="actionRow" style="margin-top:16px">
        <button id="btnResponder" class="btn primary">Enviar</button>
        <button id="btnLimpar" class="btn secondary">Limpar</button>
      </div>

      <audio id="fxCerteza"      src="audio/silvio-santos-voce-tem-certeza.mp3" preload="auto"></audio>
      <audio id="fxEntendeu"     src="audio/silvio-santos-voce-entendeu-a-pergunta.mp3" preload="auto"></audio>
      <audio id="fxEstaCerto"    src="audio/silvio-santos-esta-certo-disso.mp3" preload="auto"></audio>
      <audio id="fxQualResposta" src="audio/silvio-santos-qual-e-a-resposta-certa.mp3" preload="auto"></audio>
      <audio id="fxCertaResposta"src="audio/silvio-santos-certa-resposta.mp3" preload="auto"></audio>
      <audio id="fxErrou"        src="audio/faustao-errou.mp3" preload="auto"></audio>
      <audio id="fxAbertura"     src="audio/silvio-santos-abertura-show-do-milhao.mp3" preload="auto" loop></audio>
    </section>
  </main>

  <div id="fxOverlay" aria-hidden="true"></div>

  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.js"></script>

<script>
(function(){
  /* ---------- Supabase ---------- */
  const sb = supabase.createClient(
    "https://ihajmegcdgwchxslnaep.supabase.co",
    "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImloYWptZWdjZGd3Y2h4c2xuYWVwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY0OTQzMTgsImV4cCI6MjA3MjA3MDMxOH0.WM36lA9n0PU9qd-DKdrWVB_UzGVXpsfJ984oHiXDU8Y"
  );

  /* ---------- refs ---------- */
  const hero = document.getElementById('hero');
  const heroImg = document.getElementById('heroImg');
  const crentaoLogo = document.getElementById('crentaoLogo');
  const fxOverlay = document.getElementById('fxOverlay');

  const fxAbertura     = document.getElementById('fxAbertura');
  const fxCerteza      = document.getElementById('fxCerteza');
  const fxEntendeu     = document.getElementById('fxEntendeu');
  const fxEstaCerto    = document.getElementById('fxEstaCerto');
  const fxQualResposta = document.getElementById('fxQualResposta');
  const fxCerta        = document.getElementById('fxCertaResposta');
  const fxErrou        = document.getElementById('fxErrou');

  const canPlay = a => { try { a.currentTime=0; a.play().catch(()=>{}); } catch(e){} };
  const stop = a => { try { a.pause(); a.currentTime=0; } catch(e){} };
  const stopAllFx = ()=>[fxAbertura,fxCerteza,fxEntendeu,fxEstaCerto,fxQualResposta,fxCerta,fxErrou].forEach(stop);

  const secForm = document.getElementById('section-form');
  const secQuiz = document.getElementById('section-quiz');

  const btnStart   = document.getElementById('btnStart');

  /* helpers */
  function playAndWait(audio){
    return new Promise(resolve=>{
      try{
        audio.currentTime = 0;
        const onEnd = ()=>{ audio.removeEventListener('ended', onEnd); resolve(); };
        audio.addEventListener('ended', onEnd);
        audio.play().catch(()=>resolve());
      }catch(e){ resolve(); }
    });
  }
  function showFx(type){
    return new Promise(resolve=>{
      const cls = type === 'ok' ? 'fx-ok' : 'fx-wrong';
      fxOverlay.classList.add(cls);
      setTimeout(()=>{ fxOverlay.classList.remove(cls); resolve(); }, type === 'ok' ? 950 : 800);
    });
  }
  function testaImagem(src){
    return new Promise(resolve=>{
      const i = new Image();
      i.onload = ()=>resolve(true);
      i.onerror = ()=>resolve(false);
      i.src = src + '?v=' + Date.now();
    });
  }
  function hideAll(){ secForm.classList.add('hidden'); secQuiz.classList.add('hidden'); }
  function toggleLogo(show){ crentaoLogo.style.display = show ? '' : 'none'; }
  function goHome(){ hideAll(); stopAllFx(); toggleLogo(false); window.scrollTo(0,0); hero.style.display='block'; hero.style.transition=''; hero.style.opacity='1'; hero.style.transform='none'; }

  /* logo do topo */
  (async function(){ const path='img/logosc.png'; if (await testaImagem(path)) crentaoLogo.src=path; })();

  /* capa */
  (async function(){
    const caps=['img/cover.png','img/cover.jpg','img/cover.webp','img/capa.png','img/capa.jpg','img/show-crentao-bg.png','img/show-crentao-bg.jpg','img/logosc.png'];
    for (const src of caps){ if (await testaImagem(src)){ heroImg.src=src; heroImg.classList.remove('hidden'); return; } }
    hero.style.background='#000';
  })();

  /* navega√ß√£o home */
  btnStart.addEventListener('click', ()=>{
    canPlay(fxAbertura);
    hero.style.transition='transform .35s ease, opacity .35s ease';
    hero.style.transform='translateY(-8px)'; hero.style.opacity='0';
    setTimeout(()=>{ hero.style.display='none'; hideAll(); toggleLogo(false); secForm.classList.remove('hidden'); }, 360);
  });

  /* storage + form */
  const nome=document.getElementById('nome');
  const fone=document.getElementById('fone');
  const btnEnviarDados=document.getElementById('btnEnviarDados');

  const LS={ get:(k,def)=>{ try{return JSON.parse(localStorage.getItem(k)) ?? def}catch(_){return def} },
             set:(k,v)=>localStorage.setItem(k, JSON.stringify(v)),
             del:(k)=>localStorage.removeItem(k) };

  let participanteAtual=null;

  btnEnviarDados.addEventListener('click', ()=>{
    const n=(nome.value||'').trim(); const f=(fone.value||'').trim();
    if(!n || !f){ alert('Preencha nome e telefone.'); return; }
    const ja=LS.get('respondidos', {});
    if(ja[f]){ alert('Este telefone j√° respondeu.'); return; }
    ja[f]={nome:n, quando:Date.now()}; LS.set('respondidos', ja);
    participanteAtual={nome:n, fone:f}; stop(fxAbertura); iniciarQuiz();
  });

  /* ====== BANCO DE 50 PERGUNTAS ====== */
  const bancoPerguntas = [
    { enunciado:'Qual era a principal caracter√≠stica de Abra√£o que o tornou conhecido como "pai da f√©"?', opcoes:['Coragem nas batalhas','Obedi√™ncia imediata','Riquezas herdadas','Ser sacerdote em sua terra'], certa:1 },
    { enunciado:'Segundo o discipulado, qual √© o prop√≥sito original do crist√£o?', opcoes:['Servir','Ensinar','Louvar','Jejuar'], certa:0 },
    { enunciado:'Quem √© o maior exemplo de servo na Terra?', opcoes:['Davi','Mois√©s','Jesus','Paulo'], certa:2 },
    { enunciado:'Complete: "Servir √© para pessoas ___".', opcoes:['Imaturas','Orgulhosas','Santas','Maduras'], certa:3 },
    { enunciado:'O que significa ‚Äúobedi√™ncia imediata‚Äù na vida crist√£?', opcoes:['Responder sem demora ao que Deus ordena','Esperar sinais antes de agir','Fazer somente parte do que foi pedido','Obedecer apenas quando for conveniente'], certa:0 },
    { enunciado:'Segundo o discipulado, a f√© √© comparada a qu√™?', opcoes:['Uma √°rvore','Um m√∫sculo','Uma chama','Um tesouro'], certa:1 },
    { enunciado:'Qual √© a diferen√ßa entre ser volunt√°rio e ser servo?', opcoes:['O volunt√°rio foca em tarefas; o servo foca em prop√≥sito','O volunt√°rio recebe recompensa; o servo n√£o','O volunt√°rio sempre tem menos valor que o servo','O servo n√£o pode errar, o volunt√°rio pode'], certa:0 },
    { enunciado:'De acordo com o discipulado, qual √© a chave para obtermos o respaldo de Deus?', opcoes:['Santidade','Ora√ß√£o longa','Ser volunt√°rio','Conhecimento teol√≥gico'], certa:0 },
    { enunciado:'Quais s√£o os tr√™s elementos que levam a cumprir o prop√≥sito de Deus?', opcoes:['F√©, ora√ß√£o, jejum','Obedi√™ncia, f√© genu√≠na, perseveran√ßa','Dons, talentos, carisma','Conhecimento, obras, disciplina'], certa:1 },
    { enunciado:'Qual foi o prop√≥sito do preparo de Jesus durante 30 anos antes do minist√©rio p√∫blico?', opcoes:['Aprender sobre pol√≠tica','Preparar-se para servir','Tornar-se mestre da Lei','Receber poder sobrenatural'], certa:1 },
    { enunciado:'Cite duas caracter√≠sticas de um servo com vis√£o de l√≠der.', opcoes:['Busca status e poder','√â escolhido em tempos de crise e estabelece limites de integridade','Nunca enfrenta tenta√ß√µes e sempre tem dons','Vive isolado do povo e evita responsabilidades'], certa:1 },
    { enunciado:'Quais s√£o as consequ√™ncias de perder a santidade, segundo o discipulado?', opcoes:['Ter sonhos ruins e sentir medo','Tornar-se escravo, perder vis√£o, ser escarnecido, e morte','Perder amigos, recursos financeiros e minist√©rio','Ter enfermidades e perder dons espirituais'], certa:1 },
    { enunciado:'O que pode afetar a santidade de um crist√£o?', opcoes:['Confiar demais na carne, brincar com tenta√ß√µes, jugo desigual','Orar em l√≠nguas, jejuar em excesso, ler pouco','Amar demais as pessoas, trabalhar muito, estudar pouco','Estar em crise, passar por desertos, enfrentar tenta√ß√µes'], certa:0 },
    { enunciado:'Sans√£o foi separado por Deus para ser libertador. O que o levou √† queda?', opcoes:['Falta de dons espirituais','Desobedi√™ncia a seus pais','Falta de cuidado no relacionamento com Deus','Persegui√ß√£o dos filisteus'], certa:2 },
    { enunciado:'Segundo o discipulado, qual √© a rela√ß√£o entre santidade e efetividade no Reino de Deus?', opcoes:['Santidade garante apenas a salva√ß√£o eterna','Santidade √© necess√°ria para ter respaldo e comunh√£o com Deus','Santidade √© opcional se houver obedi√™ncia','Santidade s√≥ √© exigida dos l√≠deres'], certa:1 },
    { enunciado:'Qual √© o processo completo para restaurar a santidade, segundo o discipulado?', opcoes:['Orar, jejuar e se esfor√ßar mais','Arrependimento, favor de Deus, renova√ß√£o da un√ß√£o, deixar o pecado, compromisso com Deus','Estudar a B√≠blia, cantar louvores, congregar','Seguir regras da igreja e evitar pecados vis√≠veis'], certa:1 },
    ...Array.from({length:34}, (_,i)=>({
      enunciado:`Pergunta dif√≠cil n√∫mero ${17+i}`,
      opcoes:['Alternativa 1','Alternativa 2','Alternativa 3','Alternativa 4'],
      certa:1
    }))
  ];

  /* escada e checkpoints */
  const ladder=[100,200,300,500,1000,2000,5000,10000,20000,50000,100000,200000,300000,500000,750000,1000000];
  const safeIdx=new Set([4,9,14]); // 5/10/15

  // Sorteio/embaralhar
  function shuffle(arr){
    for(let i=arr.length-1;i>0;i--){
      const j=Math.floor(Math.random()*(i+1));
      [arr[i],arr[j]]=[arr[j],arr[i]];
    }
    return arr;
  }
  function sortearPerguntas(banco, n){
    return shuffle(banco.slice()).slice(0,n).map(p=>{
      const pares = p.opcoes.map((txt,idx)=>({txt,idx}));
      shuffle(pares);
      const opcoes = pares.map(o=>o.txt);
      const novaCerta = pares.findIndex(o=>o.idx===p.certa);
      return { enunciado:p.enunciado, opcoes, certa:novaCerta };
    });
  }

  let perguntas=[]; // ser√° preenchido no in√≠cio da partida
  let idx=0, escolha=null, acertos=0;

  // Lifelines
  const lifelines={uni:true, fifty:true, skip:true};

  // refs quiz
  const elPerg=document.getElementById('quizPergunta');
  const elSub=document.getElementById('valorPergunta');
  const elOps=document.getElementById('quizOpcoes');
  const actionRow=document.getElementById('actionRow');
  const btnResp=document.getElementById('btnResponder');
  const btnLimpar=document.getElementById('btnLimpar');
  const confirmBox=document.getElementById('confirmBox');
  const btnConf=document.getElementById('btnConfirmar');

  const posBox=document.getElementById('posAcertoBox');
  const posTitulo=document.getElementById('posAcertoTitulo');
  const btnParar=document.getElementById('btnParar');
  const btnContinuar=document.getElementById('btnContinuar');

  const ajudaBox=document.getElementById('ajudaBox');
  const btnUni=document.getElementById('btnUni');
  const btn5050=document.getElementById('btn5050');
  const btnPular=document.getElementById('btnPular');

  function setLifelineButtons(){
    btnUni.disabled=!lifelines.uni;   btnUni.style.opacity=lifelines.uni?1:.5;
    btn5050.disabled=!lifelines.fifty;btn5050.style.opacity=lifelines.fifty?1:.5;
    btnPular.disabled=!lifelines.skip;btnPular.style.opacity=lifelines.skip?1:.5;
  }

  function showActions(){ actionRow.classList.remove('hidden'); confirmBox.classList.add('hidden'); posBox.classList.add('hidden'); }
  function showConfirm(){ actionRow.classList.add('hidden'); confirmBox.classList.remove('hidden'); posBox.classList.add('hidden'); }
  function showPosAcerto(){ actionRow.classList.add('hidden'); confirmBox.classList.add('hidden'); posBox.classList.remove('hidden'); }

  function iniciarQuiz(){
    // sorteia 16 do banco de 50 e embaralha alternativas
    perguntas = sortearPerguntas(bancoPerguntas, 16);

    hideAll(); secQuiz.classList.remove('hidden'); toggleLogo(true);
    idx=0; escolha=null; acertos=0;
    lifelines.uni=true; lifelines.fifty=true; lifelines.skip=true;
    canPlay(fxEntendeu);
    renderPergunta();
  }

  function renderPergunta(){
    const p=perguntas[idx];
    elPerg.textContent=`Pergunta ${idx+1} de ${perguntas.length}: ${p.enunciado}`;
    elSub.textContent=`Vale ${ladder[idx].toLocaleString('pt-BR')} talento(s) de sabedoria`;
    elOps.innerHTML=''; ajudaBox.classList.add('hidden'); ajudaBox.innerHTML='';
    showActions(); setLifelineButtons();

    p.opcoes.forEach((txt,i)=>{
      const li=document.createElement('label');
      li.style.cssText='display:flex;gap:10px;align-items:center;margin:10px 0';
      li.innerHTML=`<input type="radio" name="op" value="${i}" /> <span>${txt}</span>`;
      elOps.appendChild(li);
    });
    elOps.querySelectorAll('input[name=op]').forEach(r=>r.addEventListener('change',()=>{ escolha=+r.value; }));
  }

  /* Ajudas */
  btnUni.addEventListener('click', ()=>{
    if(!lifelines.uni) return;
    lifelines.uni=false; setLifelineButtons();
    const correta=perguntas[idx].certa;
    let votos=[0,0,0,0];
    let base=60+Math.floor(Math.random()*16);
    votos[correta]=base;
    let resto=100-base;
    const indices=[0,1,2,3].filter(i=>i!==correta);
    indices.forEach((i,k)=>{
      const part = k<indices.length-1 ? Math.floor(Math.random()*(resto-(indices.length-1-k))) : resto;
      votos[i]=part; resto-=part;
    });
    ajudaBox.innerHTML = 'Universit√°rios: ' + votos.map((v,i)=>`<br>(${String.fromCharCode(65+i)}) ${v}%`).join('');
    ajudaBox.classList.remove('hidden');
  });

  btn5050.addEventListener('click', ()=>{
    if(!lifelines.fifty) return;
    lifelines.fifty=false; setLifelineButtons();
    const correta=perguntas[idx].certa;
    const erradas=[0,1,2,3].filter(i=>i!==correta);
    while (erradas.length>1) {
      const remove=erradas.splice(Math.floor(Math.random()*erradas.length),1)[0];
      const input=elOps.querySelector(`input[value="${remove}"]`);
      if(input){ input.disabled=true; input.parentElement.style.opacity=.35; }
    }
  });

  btnPular.addEventListener('click', ()=>{
    if(!lifelines.skip) return;
    lifelines.skip=false; setLifelineButtons();
    idx++;
    if(idx<perguntas.length){ renderPergunta(); canPlay(fxEntendeu); }
    else { finalizar(false, true); }
  });

  /* fluxo de resposta */
  btnResp.addEventListener('click', ()=>{
    if(escolha===null){ canPlay(fxCerteza); return; }
    showConfirm(); stopAllFx(); canPlay([fxCerteza,fxEstaCerto,fxQualResposta][idx % 3]);
  });

  btnConf.addEventListener('click', async ()=>{
    stopAllFx();
    const ok=(escolha===perguntas[idx].certa);

    if(ok){
      acertos++;
      await Promise.all([playAndWait(fxCerta), showFx('ok')]);
      const ganhoAtual = ladder[idx].toLocaleString('pt-BR');
      posTitulo.textContent = `Acertou! Voc√™ j√° tem ${ganhoAtual} talento(s). Deseja PARAR agora ou CONTINUAR?`;
      showPosAcerto();

      btnParar.onclick = ()=> finalizar(true, false);
      btnContinuar.onclick = ()=>{
        idx++;
        if(idx<perguntas.length){ renderPergunta(); canPlay(fxEntendeu); }
        else { finalizar(false, false); }
      };
    } else {
      await Promise.all([playAndWait(fxErrou), showFx('wrong')]);
      finalizar(false, false, true);
    }
  });

  btnLimpar.addEventListener('click', ()=>{
    elOps.querySelectorAll('input[name=op]').forEach(r=>r.checked=false);
    escolha=null;
  });

  /* ranking / pontua√ß√£o */
  function calculaCheckpoint(){
    if (acertos===0) return 0;
    if (acertos===perguntas.length) return ladder[ladder.length-1];
    let premio=0;
    for (let i=0;i<acertos;i++){ if(safeIdx.has(i)) premio=ladder[i]; }
    return premio;
  }

  // finalizar(parouVoluntariamente=false, pulouNoFim=false, errou=false)
  async function finalizar(parou=false, pulouNoFim=false, errou=false){
    let tesouro=0;
    if (parou) {
      tesouro = ladder[idx];
    } else if (errou) {
      tesouro = calculaCheckpoint();
    } else {
      tesouro = acertos===perguntas.length ? ladder[ladder.length-1] : calculaCheckpoint();
    }

    // grava no Supabase
    try{
      await sb.from('ranking').insert({
        nome: participanteAtual?.nome || 'N/A',
        fone: participanteAtual?.fone || 'N/A',
        pontos: Number(acertos)||0,
        tesouro: Number(tesouro)||0,
        quando: new Date().toISOString()
      });
    }catch(e){ console.warn('Erro ao salvar no Supabase:', e); }

    // vai para a p√°gina p√∫blica de ranking
    window.location.href = 'ranking.html';
  }

})();
</script>
</body>
</html>

    #hero .cta{
      position:absolute; left:50%; transform:translateX(-50%);
      bottom: calc(12svh + env(safe-area-inset-bottom));
      width:100%; max-width: min(780px, 92vw);
      display:flex; gap:14px; flex-wrap:wrap; justify-content:center; z-index:2;
    }

    .btn{
      appearance:none; border:0; border-radius:18px; padding:18px 28px;
      font-weight:800; letter-spacing:.02em; text-transform:uppercase; cursor:pointer;
      box-shadow: var(--shadow);
      transition: transform .08s ease, box-shadow .2s ease, opacity .2s ease, filter .2s ease;
    }
    .btn:active{transform: translateY(1px); box-shadow: var(--shadow-soft);}
    .btn.primary{ background:linear-gradient(180deg, var(--green) 0%, var(--green-700) 100%); color:#06261f; }
    .btn.secondary{ background:var(--white); color:#0a0d0c }
    .btn.full{ flex:1 1 320px; }

    /* CONTE√öDO */
    main{display:grid; gap:28px; padding:24px var(--pad) 48px; max-width:var(--maxw); margin:0 auto}
    .card{
      background:rgba(12,15,15,.72); backdrop-filter: blur(6px);
      border:1px solid rgba(255,255,255,.06); border-radius:var(--radius);
      box-shadow:var(--shadow); padding: min(28px, 3.2vw);
    }
    h2{margin:0 0 6px; font-size:22px}
    .sub{margin:0 0 14px; font-size:14px; color:#a7b1af}
    label{display:block; font-size:14px; margin:14px 0 6px; color:#cdd5d3}
    input[type="text"], input[type="tel"]{
      width:100%; padding:14px 16px; border-radius:12px; border:1px solid rgba(255,255,255,.08);
      background:#0b0f0e; color:#fff; outline:none;
    }
    .help{font-size:13px; color:#93a29f; margin-top:10px}
    .row{display:flex; gap:12px; flex-wrap:wrap}
    .row .btn{min-width:180px}
    #section-form, #section-quiz, #section-ranking, #section-fim{display:none}

    .confirm-box{ margin-top:14px; padding:12px; border-radius:12px; border:1px solid rgba(255,255,255,.08); background:#0a0f0f; }
    .confirm-title{font-weight:800; margin-bottom:10px;}
    .helpbox{margin-top:12px; font-size:13px; color:#a7b1af}

    /* FX */
    #fxOverlay{ position:fixed; inset:0; pointer-events:none; z-index:60; }
    .fx-ok::after{
      content:""; position:absolute; inset:0; margin:auto; width:min(55vmin,520px); height:min(55vmin,520px);
      border-radius:50%; background:radial-gradient(ellipse at center, rgba(31,221,172,.28), rgba(31,221,172,0) 60%);
      animation:okPulse .95s ease-out forwards;
    }
    @keyframes okPulse{ 0%{transform:scale(.7); opacity:.0} 25%{opacity:.9} 100%{transform:scale(1.15); opacity:0} }
    .fx-wrong{ animation:shake .6s ease-in-out 0s 1; }
    .fx-wrong::after{
      content:""; position:absolute; inset:0;
      background:radial-gradient(ellipse at center, rgba(242,78,58,.18), rgba(242,78,58,0) 65%); animation:fadeOut .8s ease forwards;
    }
    @keyframes shake{0%,100%{transform:translateX(0)}20%{transform:translateX(-10px)}40%{transform:translateX(10px)}60%{transform:translateX(-6px)}80%{transform:translateX(6px)}}
    @keyframes fadeOut{ from{opacity:.9} to{opacity:0} }
  </style>
</head>
<body>

  <!-- topo -->
  <header>
    <div class="brand">
      <img src="img/logo.png" alt="Sobrenatural Church" onerror="this.style.display='none'">
    </div>
    <div class="right">
      <img id="crentaoLogo" class="title-logo" alt="Show do Crent√£o" />
    </div>
  </header>

  <!-- HOME -->
  <section id="hero">
    <div class="bg">
      <img id="heroImg" alt="Capa ‚Äì Show do Crent√£o" class="hidden">
    </div>
    <div class="cta">
      <button id="btnStart" class="btn primary full">Iniciar</button>
      <button class="btn secondary full" onclick="location.href='ranking.html'">Ranking</button>
    </div>
  </section>

  <main>
    <!-- FORM -->
    <section id="section-form" class="card">
      <h2>Dados do participante</h2>
      <label>Nome completo</label>
      <input id="nome" type="text" placeholder="Ex.: Maria Silva">
      <label>Telefone (com DDD)</label>
      <input id="fone" type="tel" placeholder="Ex.: (14) 99999-0000">
      <div class="help">Cada pessoa pode responder <strong>uma √∫nica vez</strong>.</div>
      <div class="row" style="margin-top:16px">
        <button id="btnEnviarDados" class="btn primary">Enviar</button>
      </div>
    </section>

    <!-- QUIZ -->
    <section id="section-quiz" class="card">
      <h2 id="quizPergunta">Pergunta</h2>
      <p id="valorPergunta" class="sub"></p>

      <!-- Ajudas -->
      <div class="row" id="lifelines" style="margin:6px 0 10px">
        <button id="btnUni"  class="btn secondary">Universit√°rios</button>
        <button id="btn5050" class="btn secondary">50/50</button>
        <button id="btnPular" class="btn secondary">Pular</button>
      </div>
      <div id="ajudaBox" class="helpbox hidden"></div>

      <div id="quizOpcoes"></div>

      <!-- Confirmar resposta -->
      <div id="confirmBox" class="confirm-box hidden">
        <div class="confirm-title">Voc√™ tem certeza da resposta?</div>
        <div class="row"><button id="btnConfirmar" class="btn primary">Confirmar</button></div>
      </div>

      <!-- Ap√≥s ACERTO: Parar ou Continuar -->
      <div id="posAcertoBox" class="confirm-box hidden">
        <div class="confirm-title" id="posAcertoTitulo"></div>
        <div class="row">
          <button id="btnParar" class="btn secondary">Parar</button>
          <button id="btnContinuar" class="btn primary">Continuar</button>
        </div>
      </div>

      <div class="row" id="actionRow" style="margin-top:16px">
        <button id="btnResponder" class="btn primary">Enviar</button>
        <button id="btnLimpar" class="btn secondary">Limpar</button>
      </div>

      <audio id="fxCerteza"      src="audio/silvio-santos-voce-tem-certeza.mp3" preload="auto"></audio>
      <audio id="fxEntendeu"     src="audio/silvio-santos-voce-entendeu-a-pergunta.mp3" preload="auto"></audio>
      <audio id="fxEstaCerto"    src="audio/silvio-santos-esta-certo-disso.mp3" preload="auto"></audio>
      <audio id="fxQualResposta" src="audio/silvio-santos-qual-e-a-resposta-certa.mp3" preload="auto"></audio>
      <audio id="fxCertaResposta"src="audio/silvio-santos-certa-resposta.mp3" preload="auto"></audio>
      <audio id="fxErrou"        src="audio/faustao-errou.mp3" preload="auto"></audio>
      <audio id="fxAbertura"     src="audio/silvio-santos-abertura-show-do-milhao.mp3" preload="auto" loop></audio>
    </section>

    <!-- FIM -->
    <section id="section-fim" class="card">
      <h2 id="fimTitulo">Resultado</h2>
      <p id="fimMsg" class="sub"></p>
      <div class="row" style="margin-top:8px">
        <button class="btn primary" id="btnFimHome">Voltar √† Home</button>
        <button class="btn secondary" onclick="location.href='ranking.html'">Ver Ranking</button>
      </div>
    </section>

    <!-- (Ranking embutido ‚Äì usado s√≥ pelo bot√£o Ranking da home se voc√™ quiser) -->
    <section id="section-ranking" class="card">
      <div style="display:flex;align-items:center;justify-content:space-between;gap:8px;">
        <h2>Ranking</h2>
        <button id="btnResetDev" class="btn secondary hidden">Limpar ranking (DEV)</button>
      </div>
      <div id="rankingLista" class="help">Sem participantes por enquanto.</div>
      <div class="row" style="margin-top:16px">
        <button id="btnVoltar" class="btn secondary">Voltar</button>
      </div>
    </section>
  </main>

  <div id="fxOverlay" aria-hidden="true"></div>

  <!-- Supabase UMD (n√£o-module) -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.js"></script>

  <!-- App -->
  <script>
  (function(){
    /* ---------- Supabase ---------- */
    const SUPABASE_URL = "https://ihajmegcdgwchxslnaep.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImloYWptZWdjZGd3Y2h4c2xuYWVwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY0OTQzMTgsImV4cCI6MjA3MjA3MDMxOH0.WM36lA9n0PU9qd-DKdrWVB_UzGVXpsfJ984oHiXDU8Y";
    const sb = (window.supabase && window.supabase.createClient)
      ? window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY)
      : null;

    /* ---------- refs ---------- */
    const hero = document.getElementById('hero');
    const heroImg = document.getElementById('heroImg');
    const crentaoLogo = document.getElementById('crentaoLogo');
    const fxOverlay = document.getElementById('fxOverlay');

    const fxAbertura     = document.getElementById('fxAbertura');
    const fxCerteza      = document.getElementById('fxCerteza');
    const fxEntendeu     = document.getElementById('fxEntendeu');
    const fxEstaCerto    = document.getElementById('fxEstaCerto');
    const fxQualResposta = document.getElementById('fxQualResposta');
    const fxCerta        = document.getElementById('fxCertaResposta');
    const fxErrou        = document.getElementById('fxErrou');

    const canPlay = a => { try { a.currentTime=0; a.play().catch(()=>{}); } catch(e){} };
    const stop = a => { try { a.pause(); a.currentTime=0; } catch(e){} };
    const stopAllFx = ()=>[fxAbertura,fxCerteza,fxEntendeu,fxEstaCerto,fxQualResposta,fxCerta,fxErrou].forEach(stop);

    const secForm = document.getElementById('section-form');
    const secQuiz = document.getElementById('section-quiz');
    const secRank = document.getElementById('section-ranking');
    const secFim  = document.getElementById('section-fim');

    const btnStart   = document.getElementById('btnStart');
    const btnVoltar  = document.getElementById('btnVoltar');
    const btnFimHome = document.getElementById('btnFimHome');

    /* ---------- helpers ---------- */
    function playAndWait(audio){
      return new Promise(resolve=>{
        try{
          audio.currentTime = 0;
          const onEnd = ()=>{ audio.removeEventListener('ended', onEnd); resolve(); };
          audio.addEventListener('ended', onEnd);
          audio.play().catch(()=>resolve());
        }catch(e){ resolve(); }
      });
    }
    function showFx(type){
      return new Promise(resolve=>{
        const cls = type === 'ok' ? 'fx-ok' : 'fx-wrong';
        fxOverlay.classList.add(cls);
        setTimeout(()=>{ fxOverlay.classList.remove(cls); resolve(); }, type === 'ok' ? 950 : 800);
      });
    }
    function testaImagem(src){
      return new Promise(resolve=>{
        const i = new Image();
        i.onload = ()=>resolve(true);
        i.onerror = ()=>resolve(false);
        i.src = src + '?v=' + Date.now();
      });
    }
    function hideAll(){ secForm.style.display='none'; secQuiz.style.display='none'; secRank.style.display='none'; secFim.style.display='none'; }
    function toggleLogo(show){ crentaoLogo.style.display = show ? '' : 'none'; }
    function goHome(){
      hideAll(); stopAllFx(); toggleLogo(false);
      window.scrollTo(0,0);
      hero.style.display='block';
      hero.style.transition='';
      hero.style.opacity='1';
      hero.style.transform='none';
    }

    /* ---------- logo e capa ---------- */
    (async function(){
      const path = 'img/logosc.png';
      if (await testaImagem(path)) crentaoLogo.src = path;
    })();

    (async function(){
      const caps=['img/cover.png','img/cover.jpg','img/cover.webp','img/capa.png','img/capa.jpg','img/show-crentao-bg.png','img/show-crentao-bg.jpg','img/logosc.png'];
      for (const src of caps){
        if (await testaImagem(src)){ heroImg.src = src; heroImg.classList.remove('hidden'); return; }
      }
      hero.style.background = '#000';
    })();

    /* ---------- navega√ß√£o home ---------- */
    btnStart.addEventListener('click', ()=>{
      canPlay(fxAbertura);
      hero.style.transition = 'transform .35s ease, opacity .35s ease';
      hero.style.transform  = 'translateY(-8px)';
      hero.style.opacity    = '0';
      setTimeout(()=>{ hero.style.display='none'; hideAll(); toggleLogo(false); secForm.style.display='block'; }, 360);
    });
    btnVoltar.addEventListener('click', goHome);
    btnFimHome.addEventListener('click', goHome);

    /* ---------- storage + form ---------- */
    const nome=document.getElementById('nome');
    const fone=document.getElementById('fone');
    const btnEnviarDados=document.getElementById('btnEnviarDados');

    const LS={ get:(k,def)=>{ try{return JSON.parse(localStorage.getItem(k)) ?? def}catch(_){return def} },
               set:(k,v)=>localStorage.setItem(k, JSON.stringify(v)),
               del:(k)=>localStorage.removeItem(k) };

    let participanteAtual=null;

    btnEnviarDados.addEventListener('click', ()=>{
      const n=(nome.value||'').trim(); const f=(fone.value||'').trim();
      if(!n || !f){ alert('Preencha nome e telefone.'); return; }
      const ja=LS.get('respondidos', {});
      if(ja[f]){ alert('Este telefone j√° respondeu.'); return; }
      ja[f]={nome:n, quando: Date.now() };
      LS.set('respondidos', ja);
      participanteAtual={ nome:n, fone:f };
      try{ stop(fxAbertura); }catch(_){}
      iniciarQuiz();
    });

    /* ---------- perguntas ---------- */
    const perguntas = [
      { enunciado:"Qual era a principal caracter√≠stica de Abra√£o que o tornou conhecido como \"pai da f√©\"?",
        opcoes:["Coragem nas batalhas","Obedi√™ncia imediata","Riquezas herdadas","Ser sacerdote em sua terra"], certa:1 },
      { enunciado:"Segundo o discipulado, qual √© o prop√≥sito original do crist√£o?",
        opcoes:["Servir","Ensinar","Louvar","Jejuar"], certa:0 },
      { enunciado:"Quem √© o maior exemplo de servo na Terra?",
        opcoes:["Davi","Mois√©s","Jesus","Paulo"], certa:2 },
      { enunciado:"Complete: \"Servir √© para pessoas ___\".",
        opcoes:["Imaturas","Orgulhosas","Santas","Maduras"], certa:3 },
      { enunciado:"O que significa ‚Äúobedi√™ncia imediata‚Äù na vida crist√£?",
        opcoes:["Responder sem demora ao que Deus ordena","Esperar sinais antes de agir","Fazer somente parte do que foi pedido","Obedecer apenas quando for conveniente"], certa:0 },
      { enunciado:"Segundo o discipulado, a f√© √© comparada a qu√™?",
        opcoes:["Uma √°rvore","Um m√∫sculo","Uma chama","Um tesouro"], certa:1 },
      { enunciado:"Qual √© a diferen√ßa entre ser volunt√°rio e ser servo?",
        opcoes:["O volunt√°rio foca em tarefas; o servo foca em prop√≥sito","O volunt√°rio recebe recompensa; o servo n√£o","O volunt√°rio sempre tem menos valor que o servo","O servo n√£o pode errar, o volunt√°rio pode"], certa:0 },
      { enunciado:"De acordo com o discipulado, qual √© a chave para obtermos o respaldo de Deus?",
        opcoes:["Santidade","Ora√ß√£o longa","Ser volunt√°rio","Conhecimento teol√≥gico"], certa:0 },
      { enunciado:"Quais s√£o os tr√™s elementos que levam a cumprir o prop√≥sito de Deus?",
        opcoes:["F√©, ora√ß√£o, jejum","Obedi√™ncia, f√© genu√≠na, perseveran√ßa","Dons, talentos, carisma","Conhecimento, obras, disciplina"], certa:1 },
      { enunciado:"Qual foi o prop√≥sito do preparo de Jesus durante 30 anos antes do minist√©rio p√∫blico?",
        opcoes:["Aprender sobre pol√≠tica","Preparar-se para servir","Tornar-se mestre da Lei","Receber poder sobrenatural"], certa:1 },
      { enunciado:"Cite duas caracter√≠sticas de um servo com vis√£o de l√≠der.",
        opcoes:["Busca status e poder","√â escolhido em tempos de crise e estabelece limites de integridade","Nunca enfrenta tenta√ß√µes e sempre tem dons","Vive isolado do povo e evita responsabilidades"], certa:1 },
      { enunciado:"Quais s√£o as consequ√™ncias de perder a santidade, segundo o discipulado?",
        opcoes:["Ter sonhos ruins e sentir medo","Tornar-se escravo, perder vis√£o, ser escarnecido, e morte","Perder amigos, recursos financeiros e minist√©rio","Ter enfermidades e perder dons espirituais"], certa:1 },
      { enunciado:"O que pode afetar a santidade de um crist√£o?",
        opcoes:["Confiar demais na carne, brincar com tenta√ß√µes, jugo desigual","Orar em l√≠nguas, jejuar em excesso, ler pouco","Amar demais as pessoas, trabalhar muito, estudar pouco","Estar em crise, passar por desertos, enfrentar tenta√ß√µes"], certa:0 },
      { enunciado:"Sans√£o foi separado por Deus para ser libertador. O que o levou √† queda?",
        opcoes:["Falta de dons espirituais","Desobedi√™ncia a seus pais","Falta de cuidado no relacionamento com Deus","Persegui√ß√£o dos filisteus"], certa:2 },
      { enunciado:"Segundo o discipulado, qual √© a rela√ß√£o entre santidade e efetividade no Reino de Deus?",
        opcoes:["Santidade garante apenas a salva√ß√£o eterna","Santidade √© necess√°ria para ter respaldo e comunh√£o com Deus","Santidade √© opcional se houver obedi√™ncia","Santidade s√≥ √© exigida dos l√≠deres"], certa:1 },
      { enunciado:"Qual √© o processo completo para restaurar a santidade, segundo o discipulado?",
        opcoes:["Orar, jejuar e se esfor√ßar mais","Arrependimento, favor de Deus, renova√ß√£o da un√ß√£o, deixar o pecado, compromisso com Deus","Estudar a B√≠blia, cantar louvores, congregar","Seguir regras da igreja e evitar pecados vis√≠veis"], certa:1 }
    ];

    /* ---------- escada ---------- */
    const ladder=[100,200,300,500,1000,2000,5000,10000,20000,50000,100000,200000,300000,500000,750000,1000000];
    const safeIdx=new Set([4,9,14]); // checkpoints

    let idx=0, escolha=null, acertos=0;
    const lifelines={uni:true, fifty:true, skip:true};

    /* ---------- refs quiz ---------- */
    const elPerg     = document.getElementById('quizPergunta');
    const elSub      = document.getElementById('valorPergunta');
    const elOps      = document.getElementById('quizOpcoes');
    const actionRow  = document.getElementById('actionRow');
    const btnResp    = document.getElementById('btnResponder');
    const btnLimpar  = document.getElementById('btnLimpar');
    const confirmBox = document.getElementById('confirmBox');
    const btnConf    = document.getElementById('btnConfirmar');

    const posBox   = document.getElementById('posAcertoBox');
    const posTitulo= document.getElementById('posAcertoTitulo');
    const btnParar = document.getElementById('btnParar');
    const btnContinuar = document.getElementById('btnContinuar');

    const ajudaBox = document.getElementById('ajudaBox');
    const btnUni   = document.getElementById('btnUni');
    const btn5050  = document.getElementById('btn5050');
    const btnPular = document.getElementById('btnPular');

    function setLifelineButtons(){
      btnUni.disabled=!lifelines.uni;   btnUni.style.opacity=lifelines.uni?1:.5;
      btn5050.disabled=!lifelines.fifty;btn5050.style.opacity=lifelines.fifty?1:.5;
      btnPular.disabled=!lifelines.skip;btnPular.style.opacity=lifelines.skip?1:.5;
    }
    function showActions(){ actionRow.classList.remove('hidden'); confirmBox.classList.add('hidden'); posBox.classList.add('hidden'); }
    function showConfirm(){ actionRow.classList.add('hidden'); confirmBox.classList.remove('hidden'); posBox.classList.add('hidden'); }
    function showPosAcerto(){ actionRow.classList.add('hidden'); confirmBox.classList.add('hidden'); posBox.classList.remove('hidden'); }

    function iniciarQuiz(){
      hideAll(); secQuiz.style.display='block'; toggleLogo(true);
      idx = 0; escolha = null; acertos = 0;
      lifelines.uni=true; lifelines.fifty=true; lifelines.skip=true;
      canPlay(fxEntendeu);
      renderPergunta();
    }

    function renderPergunta(){
      const p = perguntas[idx];
      elPerg.textContent = `Pergunta ${idx+1} de ${perguntas.length}: ${p.enunciado}`;
      elSub.textContent  = `Vale ${ladder[idx].toLocaleString('pt-BR')} talento(s) de sabedoria`;
      elOps.innerHTML = '';
      ajudaBox.classList.add('hidden'); ajudaBox.innerHTML='';
      showActions(); setLifelineButtons();

      p.opcoes.forEach((txt,i)=>{
        const li = document.createElement('label');
        li.style.cssText='display:flex;gap:10px;align-items:center;margin:10px 0';
        li.innerHTML = `<input type="radio" name="op" value="${i}" /> <span>${txt}</span>`;
        elOps.appendChild(li);
      });
      elOps.querySelectorAll('input[name=op]').forEach(r=>r.addEventListener('change',()=>{ escolha=+r.value; }));
    }

    /* ---------- Ajudas ---------- */
    btnUni.addEventListener('click', ()=>{
      if(!lifelines.uni) return;
      lifelines.uni=false; setLifelineButtons();
      const correta=perguntas[idx].certa;
      let votos=[0,0,0,0];
      let base=60+Math.floor(Math.random()*16); // 60‚Äì75% na correta
      votos[correta]=base;
      let resto=100-base;
      const indices=[0,1,2,3].filter(i=>i!==correta);
      indices.forEach((i,k)=>{
        const part = k<indices.length-1 ? Math.floor(Math.random()*(resto-(indices.length-1-k))) : resto;
        votos[i]=part; resto-=part;
      });
      ajudaBox.innerHTML = 'Universit√°rios: ' + votos.map((v,i)=>`<br>(${String.fromCharCode(65+i)}) ${v}%`).join('');
      ajudaBox.classList.remove('hidden');
    });

    btn5050.addEventListener('click', ()=>{
      if(!lifelines.fifty) return;
      lifelines.fifty=false; setLifelineButtons();
      const correta=perguntas[idx].certa;
      const erradas=[0,1,2,3].filter(i=>i!==correta);
      while (erradas.length>1) {
        const remove=erradas.splice(Math.floor(Math.random()*erradas.length),1)[0];
        const input=elOps.querySelector(`input[value="${remove}"]`);
        if(input){ input.disabled=true; input.parentElement.style.opacity=.35; }
      }
    });

    btnPular.addEventListener('click', ()=>{
      if(!lifelines.skip) return;
      lifelines.skip=false; setLifelineButtons();
      idx++;
      if(idx<perguntas.length){ renderPergunta(); canPlay(fxEntendeu); }
      else { finalizar(false, true); }
    });

    /* ---------- fluxo ---------- */
    btnResp.addEventListener('click', ()=>{
      if(escolha===null){ canPlay(fxCerteza); return; }
      showConfirm(); stopAllFx();
      canPlay([fxCerteza,fxEstaCerto,fxQualResposta][idx % 3]);
    });

    btnConf.addEventListener('click', async ()=>{
      stopAllFx();
      const ok=(escolha===perguntas[idx].certa);

      if(ok){
        acertos++; 
        await Promise.all([playAndWait(fxCerta), showFx('ok')]);
        const ganhoAtual = ladder[idx].toLocaleString('pt-BR');
        posTitulo.textContent = `Acertou! Voc√™ j√° tem ${ganhoAtual} talento(s). Deseja PARAR agora ou CONTINUAR?`;
        showPosAcerto();
        btnParar.onclick = ()=> finalizar(true, false);
        btnContinuar.onclick = ()=>{
          idx++;
          if(idx<perguntas.length){ renderPergunta(); canPlay(fxEntendeu); }
          else { finalizar(false, false); }
        };
      } else {
        await Promise.all([playAndWait(fxErrou), showFx('wrong')]);
        finalizar(false, false, true);
      }
    });

    btnLimpar.addEventListener('click', ()=>{
      elOps.querySelectorAll('input[name=op]').forEach(r=>r.checked=false);
      escolha=null;
    });

    /* ---------- ranking / pontua√ß√£o ---------- */
    function calculaCheckpoint(){
      if (acertos===0) return 0;
      if (acertos===perguntas.length) return ladder[ladder.length-1];
      let premio=0;
      for (let i=0;i<acertos;i++){ if (safeIdx.has(i)) premio=ladder[i]; }
      return premio;
    }

    async function salvarSupabase(reg){
      if(!sb) return; // se CDN falhar, o jogo segue
      try{
        const { error } = await sb.from('ranking').insert(reg);
        if (error) console.warn('Supabase insert error:', error.message);
      }catch(e){ console.warn('Supabase fail:', e?.message||e); }
    }

    function fimUI({titulo, msg}){
      document.getElementById('fimTitulo').textContent = titulo;
      document.getElementById('fimMsg').textContent = msg;
      hideAll(); toggleLogo(true); secFim.style.display='block';
    }

    // finalizar(parouVoluntariamente=false, pulouNoFim=false, errou=false)
    async function finalizar(parou=false, pulouNoFim=false, errou=false){
      let tesouro=0;
      if (parou) {
        tesouro = ladder[idx];
      } else if (errou) {
        tesouro = calculaCheckpoint();
      } else {
        tesouro = acertos===perguntas.length ? ladder[ladder.length-1] : calculaCheckpoint();
      }

      const reg = {
        nome: participanteAtual?.nome||'',
        fone: participanteAtual?.fone||'',
        pontos: Number(acertos)||0,
        tesouro: Number(tesouro)||0,
        quando: new Date().toISOString()
      };
      salvarSupabase(reg);

      const talentos = tesouro.toLocaleString('pt-BR');
      if (errou){
        fimUI({titulo:"N√£o foi desta vez üòÖ", msg:`Voc√™ acumulou ${talentos} talento(s) e acertou ${acertos} pergunta(s). Tente novamente!`});
      } else if (parou){
        fimUI({titulo:"Voc√™ decidiu parar üëè", msg:`Voc√™ encerrou com ${talentos} talento(s) e ${acertos} acerto(s).`});
      } else if (acertos===perguntas.length){
        fimUI({titulo:"üéâ Parab√©ns! Voc√™ zerou o Crent√£o!", msg:`Voc√™ conquistou ${talentos} talento(s) e acertou todas as ${acertos} perguntas!`});
      } else {
        fimUI({titulo:"Fim do jogo", msg:`Voc√™ finalizou com ${talentos} talento(s) e ${acertos} acerto(s).`});
      }
    }

    async function renderRanking(){
      const box=document.getElementById('rankingLista');
      if(!sb){ box.textContent='Ranking indispon√≠vel (offline).'; return; }
      try{
        const {data,error}=await sb.from('ranking')
          .select('nome, fone, pontos, tesouro, quando')
          .order('tesouro',{ascending:false})
          .order('pontos',{ascending:false})
          .order('quando',{ascending:true})
          .limit(100);
        if(error) throw error;
        if(!data?.length){ box.textContent='Sem participantes por enquanto.'; return; }
        box.innerHTML=data.map((r,i)=>`${i+1}. ${r.nome} ‚Äî ${r.fone} ‚Äî ${Number(r.tesouro||0).toLocaleString('pt-BR')} talento(s) ¬∑ ${r.pontos} acerto(s)`)
          .map(l=>`<div style="padding:6px 0;border-bottom:1px solid rgba(255,255,255,.06)">${l}</div>`).join('');
      }catch(e){
        box.textContent='Falha ao carregar ranking.';
      }
    }

    /* ---------- DEV reset (opcional) ---------- */
    const btnResetDev = document.getElementById('btnResetDev');
    if (location.hash === '#dev') {
      btnResetDev.classList.remove('hidden');
      btnResetDev.addEventListener('click', ()=>{
        if (confirm('Apagar todos os resultados do ranking neste navegador?')) {
          LS.del('ranking'); LS.del('respondidos'); renderRanking();
          alert('Ranking limpo (apenas neste navegador).');
        }
      });
    }

    // exp√µe para o bot√£o Ranking embutido (se usar)
    window.renderRanking = renderRanking;
  })();
  </script>
</body>
</html>
